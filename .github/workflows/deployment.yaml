name: Run commands on different operating systems
on:
  push:

jobs:
  Build-and-Push-Windows-Container-Image:
    name: Building on Windows
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v3
#       - name: Install PSScriptAnalyzer module
#         shell: pwsh
#         run: |
#           Set-PSRepository PSGallery -InstallationPolicy Trusted
#           Install-Module PSScriptAnalyzer -ErrorAction Stop
      - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v1'
        with:
          credentials_json: '${{ secrets.GOOGLE_CREDENTIALS }}' #service account key.JSON must be flatened/minified
      - name: "Build and Push Container Image"
        shell: pwsh
        run: |
          cat *.json | docker login https://asia.gcr.io -u _json_key --password-stdin
          docker build -t asia.gcr.io/gj-playground/aspnet:0.1 .
          docker images
          docker push asia.gcr.io/gj-playground/aspnet:0.1
      - name: Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        uses: Ilshidur/action-discord@master
        with:
          args: 'The project {{ EVENT_PAYLOAD.repository.full_name }} has been deployed.'
